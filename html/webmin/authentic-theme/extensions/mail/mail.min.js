'use strict';var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}var mail=function(){var _={path:{origin:v___location_origin,prefix:v___location_prefix,extensions:v___server_extensions_path,css:v___server_css_path,js:v___server_js_path},variable:{switch:function _switch(){return $t_uri_webmail;},module:{name:function name(){return v___module;},link:function link(){var prefix=v___location_prefix;return prefix?prefix+'/'+v___module:'/'+this.name();}}},content:get_pjax_content,load:load,language:theme_language,notification:theme_messenger,rows:page_table_rows_control,navigation:{reset:navigation_clear},plugin:{json_to_query:Convert.json_to_query,timestamp:time.localize,offset_adjust:page.handle.content.offset,select:function select(data){var size=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'34';if(Array.isArray(data)){data[0].select2(data[1]);return;}data.select2({minimumResultsForSearch:5,containerCssClass:'select2-content heighter-'+size,dropdownCssClass:'select2-content h'+size});data.next('.select2').addClass('select2-content-container');data.on('select2:open',function(){$('.select2-container').off('click.container').on('click.container',function(event){event.stopPropagation();});});},scroll:function scroll(target,options){if(typeof target==='string'){$(target).mCustomScrollbar(options);}else{$(target[0]).mCustomScrollbar('scrollTo',target[1],{scrollOffset:[$(target[0]),3,4]});}},tooltip:function tooltip(){$('[data-tooltip="mailbox"]').tooltip({html:true,trigger:'hover',container:'body',delay:{show:600,hide:30}});}}},$$={$:{layout:{container:'container-fluid',controls:'mail-controls',panel:'panel-mail panel-body',row:{controls:'row row-controls',messages:'row row-messages colorify',quota:'row row-quota'},column:{3:'col-xs-3',4:'col-xs-4',6:'col-xs-6',8:'col-xs-8',9:'col-xs-9',12:'col-xs-12'},button:{link:'btn btn-link text-decoration-none',transparent:'btn btn-link btn-transparent',default:'btn btn-default',primary:'btn btn-primary',block:'btn btn-default btn-block',dropdown:{default:'btn btn-default dropdown-toggle'}}},tree:{container:'data-mail-folders',active:'fancytree-active',loader:'fancytree-loader'},controls:{compose:{button:'[data-compose]',icon:'fa-fw fa-plus'},select:{dropdown:'dropdown-select',checkbox:'[data-select] input',menus:'[data-select-mass]'},delete:'btn btn-default fa fa-trash',forward:'btn btn-default fa fa-forward',search:{link:'[data-href^="sort.cgi"]',clear:{link:'search-clear text-danger',icon:'fa-fw fa-times-circle-o'},dropdown:'dropdown-search',icon:'fa-search',data:{form:{action:'data-form-action',type:'data-form-action-type',advanced:'data-form-action-advanced'}},button:{type:'[data-toggle-type="1"]'},caret:{down:'fa-caret-down',up:'fa-caret-up'},submit:'[data-search-submit]'},move:{dropdown:'dropdown-move',checkbox:'[data-copy-only]',icon:'fa-folder-move',submit:'[data-transfer-submit]'},more:{dropdown:'dropdown-more',icon:'fa-dots-vertical',menu:{read:'[data-form-action="markas1"]',unread:'[data-form-action="markas0"]',special:'[data-form-action="markas2"]',spam:'[data-form-action="razor"]',ham:'[data-form-action="ham"]',black:'[data-form-action="black"]',white:'[data-form-action="white"]'}},sort:{dropdown:'dropdown-sort',icon:'fa-fw fa-sort'},counter:'mail-selected-count',refresh:{button:'btn btn-transparent-link btn-lg btn-transparent fa fa-refresh',animation:'fa-spin-gradual'},pagination:'pagination-title',settings:'btn btn-default fa fa-cog'},mail:{checkbox:'input[data-check]',flag:'mail-list-trow-flag-security',special:{star:'star',starred:'fa-star star',unstarred:'fa-star-o star'}}},create:{$:function $(classes,data){var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'div';var content=arguments.length>3&&arguments[3]!==undefined?arguments[3]:String();var tooltip=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var attributes=this._attributes(data);classes=this._classes(classes);if(tooltip){tooltip='data-tooltip="mailbox" data-placement="bottom" data-title="'+tooltip+'"';}return'<'+type+' '+attributes+' '+tooltip+' class="'+classes+'">'+content+'</'+type+'>';},icon:function icon(classes){var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var attribute=this._attributes(attributes),icon=this._classes(classes);return'<i class="fa '+icon+' '+attribute+'"></i>';},button:function button(classes,data,content,icon,tooltip){icon=this._classes(icon);return this.$(classes,data,'button',(icon?'<i class="fa '+icon+'"></i>&nbsp;&nbsp;':'')+content+'',tooltip);},input:function input(){var name=arguments.length>0&&arguments[0]!==undefined?arguments[0]:String();var placeholder=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var type=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'text';var attributes=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var attribute=this._attributes(attributes);return'<input '+attribute+' type="'+type+'" name="'+name+'" id="'+name+'" placeholder="'+placeholder+'" value="'+value+'">';},label:function label(){var target=arguments.length>0&&arguments[0]!==undefined?arguments[0]:String();var content=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var attributes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var attribute=this._attributes(attributes);return'<label '+attribute+' for="'+target+'">'+content+'</label>';},select:function select(data){var attributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var name=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var attribute=this._attributes(attributes),select='<select '+attribute+' name="'+name+'">';var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.entries(data[0])[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref=_step.value;var _ref2=_slicedToArray(_ref,2);var value=_ref2[0];var text=_ref2[1];select+='<option value="'+value+'"'+(data[1]&&data[1]==value?' selected':String())+'>'+text+'</option>';}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}select+='</select>';return select;},checkbox:function checkbox(){var attributes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:String();var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var label=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'&nbsp;';var id=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var checked=arguments.length>5&&arguments[5]!==undefined?arguments[5]:String();var attribute=this._attributes(attributes),checkbox=String();checkbox+='<span '+attribute+' class="awcheckbox awobject">';checkbox+='<input class="iawobject" '+checked+' type="checkbox" name="'+name+'" value="'+value+'" id="'+id+'">';checkbox+='<label class="lawobject" for="'+id+'">'+label+'</label>';checkbox+='</span>';return checkbox;},radio:function radio(){var attributes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:String();var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:String();var value=arguments.length>2&&arguments[2]!==undefined?arguments[2]:String();var label=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'&nbsp;';var id=arguments.length>4&&arguments[4]!==undefined?arguments[4]:String();var checked=arguments.length>5&&arguments[5]!==undefined?arguments[5]:String();var attribute=this._attributes(attributes),checkbox=String();checkbox+='<span '+attribute+' class="awradio awobject">';checkbox+='<input class="iawobject" '+checked+' type="radio" name="'+name+'" value="'+value+'" id="'+id+'">';checkbox+='<label class="lawobject" for="'+id+'">'+label+'</label>';checkbox+='</span>';return checkbox;},dropdown:function dropdown(classes,data,button,icon,tooltip){var dropdown=String();classes=this._classes(classes);dropdown+='<div class="btn-group '+classes+'">';if(button){if(/<[a-z][\s\S]*>/i.test(button)){dropdown+=this.$('layout.button.default',false,'span',button);}else{dropdown+=this.button('layout.button.default',false,button);}}dropdown+=this.button('layout.button.dropdown.default',{'toggle':'dropdown'},'<span class="'+(icon?'fa '+$$.$.controls[icon].icon:'caret')+'"></span>',false,tooltip);dropdown+='<ul class="dropdown-menu" role="menu">';var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[0].entries()[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _ref3=_step2.value;var _ref4=_slicedToArray(_ref3,2);var i=_ref4[0];var v=_ref4[1];if(v){dropdown+='<li>'+v+'</li>';}if(data[i-1]&&data[1]&&data[1]===i+1&&data[0].length>data[1]){dropdown+='<li role="separator" class="divider"></li>';}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}dropdown+='</ul>';dropdown+='</div>';return data[0].length?dropdown:String();},_attributes:function _attributes(data){var attributes=String();if(Array.isArray(data)){attributes=data.join(' ');}else if(data){attributes=Object.entries(data).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),k=_ref6[0],v=_ref6[1];return attributes+=(k.startsWith('data-')?k:'data-'+k)+'='+v+' ';}).slice(-1)[0];}return attributes;},_classes:function _classes(classes){return classes?classes.split('.').reduce(function(a,b){return a?a[b]:undefined;},$$.$):String();}},selector:function selector(_selector){_selector=this.create._classes(_selector);return _selector.startsWith('[')?_selector:"."+_selector.replace(/\s+/g,".");},element:function element(_element){return _element?$(this.selector(_element)):String();}};var messages=function(){var get=function get(data){loader.start();_.notification('hide-all');$.post(_.path.extensions+'/mail/messages.cgi?'+_.plugin.json_to_query(data),function(data){render(data);loader.end();});},loader={target:$$.selector('tree.active'),start:function start(){$(this.target).addClass($$.$.tree.loader);},end:function end(){$(this.target).removeClass($$.$.tree.loader);}},preview_length=function preview_length(){return parseInt($(window).width()/10);},storage={target:'['+$$.$.tree.container+']',counter:$$.selector('controls.counter'),get:function get(){var status=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var data=$(this.target).data('messages')||{};if(!status){data=Object.keys(data);}return data;},set:function set(id,state,status,starred,data){var storage=this.get(1);state?storage[id]=[+status,+starred]:delete storage[id];$(this.target).data('messages',storage);var selected_count=Object.keys(storage).length;$(this.counter).text((selected_count?selected_count+' '+_.language('theme_xhred_global_selected'):String()).toLowerCase());var controls=$$.selector('layout.controls');$(controls).toggleClass('hidden',!selected_count);},restore:function restore(){var data=this.get(),checkboxes=$$.$.mail.checkbox;$(checkboxes).filter(function(i,t){data.includes(t.value)&&$(t).prop('checked',1);}).promise().done(function(){$(checkboxes).trigger('change');});},reset:function reset(){var checkboxes=$$.$.mail.checkbox;$(this.target).data('messages',{});$(checkboxes+':checked').prop('checked',0).trigger('change');}},status={action:function action(_action){var string=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_action=parseInt(_action.replace(/^\D+/g,''));if(string){return _action?'read':'unread';}return _action;},set:function set(action,messages){var $messages=$($$.$.mail.checkbox).filter(function(i,c){return messages.includes(c.value);}),$targets=$messages.parent().parents('td').parents('tr');$targets.attr('data-unread',+!this.action(action));},write:function write(data){var messages=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var folder_index=data[1].searched_folder_index||data[1].folder_index;if(messages){var action=this.action(data[0],1);messages='&d='+messages.join('&d=');$.post(_.path.extensions+'/mail/message.cgi?folder='+folder_index+'&mark='+action+messages+'');}else{var _action2=this.action(data[0],1),server=data[1],_messages=storage.get(1),starred={read:[],unread:[]};$.each(_messages,function(i,o){if(o[1]===1){o[0]===1?starred.unread.push(i):starred.read.push(i);delete _messages[i];}});submit(server,_defineProperty({},data[0],1),Object.keys(_messages),0,1);var link=_.path.extensions+'/mail/message.cgi?folder='+folder_index+'&mark=starred&state='+_action2+'';starred.read.length&&$.post(link+('&d='+starred.read.join('&d='))+'');starred.unread.length&&$.post(link+''+('&d='+starred.unread.join('&d='))+'');}}},events=function events(data){var button={search:$$.element('controls.search.dropdown'),refresh:$$.element('controls.refresh.button'),delete:$$.element('controls.delete'),forward:$$.element('controls.forward'),special:{star:$$.selector('mail.special.star'),starred:$$.selector('mail.special.starred'),unstarred:$$.selector('mail.special.unstarred')}},dropdown={mark:{read:$$.element('controls.more.menu.read'),unread:$$.element('controls.more.menu.unread'),special:$$.element('controls.more.menu.special'),spam:$$.element('controls.more.menu.spam'),ham:$$.element('controls.more.menu.ham'),black:$$.element('controls.more.menu.black'),white:$$.element('controls.more.menu.white')},select:$$.selector('controls.select.dropdown'),move:$$.element('controls.move.dropdown'),search:$$.element('controls.search.dropdown')},checkbox=$($$.$.controls.select.checkbox),checkboxes=$$.$.mail.checkbox,flags=$$.selector('mail.flag');checkbox.on('change',function(){var $this=$(this),state=$this.is(':checked');$(checkboxes).prop('checked',state).trigger('change');}).parent().parent().on('click',function(event){var $input=$(this).find('input');!$(event.target).is($input)&&$input.prop('checked',!$input.is(':checked')).trigger('change');});$(flags).on('click',function(event){event.stopPropagation();});$(dropdown.select).find($$.$.controls.select.menus).on('click',function(event){var _$=$(event.target).data('type'),$_=$(checkboxes),$__='change',__$='checked';if(_$===5||_$===4){$_.prop(__$,_$&1).trigger($__);}else if(_$===3){$_.prop(__$,function(){return!this.checked;}).trigger($__);}else if(_$===2||_$===1){$_.prop(__$,function(){return+$(this).parents('tr').attr('data-unread')===(_$&1);}).trigger($__);}else if(_$===0){$_.prop(__$,function(){return+$(this).parents('tr').attr('data-starred')===+!(_$&1);}).trigger($__);}});$(checkboxes).on('change',function(){var $this=$(this),$row=$this.parents('td').parent('tr'),state=$this.is(':checked'),id=$this.val(),checked=checkboxes+':checked',status=$row.attr('data-unread'),starred=$row.attr('data-starred');storage.set(id,state,status,starred,data);$(checked).length===$(checkboxes).length?checkbox.prop('checked',1):checkbox.prop('checked',0);});button.delete.on('click',function(){submit(data,{'delete':1},storage.get(),1,1);});var $dropdown_move_select=dropdown.move.find('select');$dropdown_move_select.find('option').map(function(i,o){o.value<=-1&&o.remove();});_.plugin.select($dropdown_move_select);$dropdown_move_select.on('change',function(){var _this=this;setTimeout(function(){$($$.$.controls.move.submit).toggleClass('disabled',!_this.value).trigger('focus');});});dropdown.move.find('li').on('click',function(event){event.stopPropagation();var $target=$(event.target),$submit=$($$.$.controls.move.submit),$copy=$($$.$.controls.move.checkbox),copy=$copy.is(':checked');if($target.is($copy)){$submit.text(copy?_.language('theme_xhred_global_copy'):_.language('theme_xhred_global_move'));}if($target.is('button:not(.disabled)')){var _submit2;var action=copy,target=parseInt($dropdown_move_select.val());submit(data,(_submit2={},_defineProperty(_submit2,(action?'copy':'move')+'1',1),_defineProperty(_submit2,'mfolder1',target),_submit2),storage.get(),+!action||(data.searched_folder_index||data.folder_index)===target,1);dropdown.move.removeClass('open');}});dropdown.move.on('shown.bs.dropdown',function(){_.plugin.select([$dropdown_move_select,'open']);});button.forward.on('click',function(){_.notification(['exclamation-triangle','Forward functionality is no yet implemented. Expect it in the future beta pre-release.'],10,"info",0,1,['top','right']);});var $dropdown_search_select=dropdown.search.find('select'),$dropdown_search_simple=dropdown.search.find('[data-search-mail]'),$dropdown_search_advanced_all=dropdown.search.find('[name="search-wordsin"]');$dropdown_search_select[0].value=data.searched_folder_index||data.folder_index;_.plugin.select($dropdown_search_select);button.search.find('li').on('click keyup',function(event){event.stopPropagation();var $target=$(event.target),$advanced_form=dropdown.search.find('['+$$.$.controls.search.data.form.advanced+']'),$submit=$($$.$.controls.search.submit),advanced_form_hidden=function advanced_form_hidden(){return window.getComputedStyle($advanced_form[0]).display==='none';};if(event.keyCode===27){button.search.trigger('click');return;}if((event.keyCode===32||event.keyCode===9||event.keyCode===13||event.type==='click')&&$target.is($($$.selector('controls.search.caret.down')).add($$.selector('controls.search.button.type')))){var $caret=$target.is('i')?$target:$target.find('i');$caret.toggleClass($$.$.controls.search.caret.up);$advanced_form.toggleClass('show');$dropdown_search_simple[0].disabled=!advanced_form_hidden();var focus_target=advanced_form_hidden()?$dropdown_search_simple:$advanced_form[0].querySelector('input');focus_target.focus();if(advanced_form_hidden()){$dropdown_search_simple.val($dropdown_search_advanced_all.val());$dropdown_search_advanced_all.val(String());}else{$dropdown_search_advanced_all.val($dropdown_search_simple.val());$dropdown_search_simple.val(String());}return;}if(event.type==='keyup'&&event.keyCode===13&&$target.is('[type="text"], [type="number"]')||event.type==='click'&&$target.is('button:not(.disabled)')){var simple_query={folder:parseInt($dropdown_search_select[0].value),search:$dropdown_search_simple[0].value};if(advanced_form_hidden()){if(simple_query.search){$.post(_.path.prefix+'/'+_.variable.module.name()+'/mail_search.cgi?returned_format=json&json-error=1&simple=1&'+_.plugin.json_to_query(simple_query),function(data){messages.get(data);});}}else{var $elements_input=$advanced_form.find('input[type="text"]').filter(function(i,v){return v.value;}),$elements_radios_status=$advanced_form.find('input[name="status"]'),$elements_limit=$advanced_form.find('input[name^="limit"]'),$elements_attach=$advanced_form.find('input[name="attach"]'),query={};query.all=1;query.dest_def=1;query.folder=simple_query.folder;for(var i=0;i<$elements_input.length;i++){var value=$elements_input[i].value,special=$elements_input[i].name.includes('words'),name=$elements_input[i].name.replace('search-',String());if(value){query['what_'+i]=value;if(special){query['field_'+i]='all';query['neg_'+i]=~~$elements_input[i].name.includes('out');}else{query['field_'+i]=name;query['neg_'+i]=0;}}}query.status_def=0;for(var _i=0;_i<$elements_radios_status.length;_i++){var $this=$elements_radios_status[_i],_value=$this.value,def=_value==-1?1:0;if($this.checked){query.status_def=def;if(!def){query.status=_value;}}}for(var _i2=0;_i2<$elements_limit.length;_i2++){var _$this=$elements_limit[_i2],_name=_$this.name;if(_$this.checked&&_$this.name==='limit_def'||_$this.name!=='limit_def'){query[_name]=_$this.value;}}query.attach=~~$elements_attach[0].checked;$.post(_.path.prefix+'/'+_.variable.module.name()+'/mail_search.cgi?returned_format=json&json-error=1&'+_.plugin.json_to_query(query),function(data){messages.get(data);});}}});dropdown.search.on('shown.bs.dropdown',function(){$dropdown_search_simple.trigger('focus');});button.refresh.on('click',function(){$(this).addClass($$.$.controls.refresh.animation);$$.element('tree.active').click();});$(button.special.star).on('click',function(event){event.stopImmediatePropagation();var $this=$(this),$row=$(event.target).parents('td').parent('tr'),target=$$.$.mail.special,id=$row.find('input[value]').val(),state=$(event.target).is($(button.special.starred))?1:0,unread=+$row.attr('data-unread'),text=_.language('theme_xhred_global_'+(state?'unstarred':'starred')+'');$row.attr('data-starred',+!state);submit(data,_defineProperty({},'markas'+(state?1:2)+'',1),[id]);$this.removeClass(target[state?'starred':'unstarred']).addClass(target[state?'unstarred':'starred']).attr('data-original-title',text).next().remove();status.write([(+!unread).toString(),data],[id]);});dropdown.mark.read.add(dropdown.mark.unread).on('click',function(){var action=$(this).data('form-action'),messages=storage.get();status.write([action,data]);status.set(action,messages);});dropdown.mark.spam.add(dropdown.mark.ham).add(dropdown.mark.black).add(dropdown.mark.white).on('click',function(){var action=$(this).data('form-action'),messages=storage.get(),refetch=/white|black/.test(action);submit(data,_defineProperty({},action,1),messages,+refetch,1);});$($$.$.controls.search.link).on('click',function(){var link=this.getAttribute('data-href');fetch(link).then(function(response){return response.json();}).then(function(data){messages.get(data);});});$($$.$.controls.compose.button).off('click');$($$.$.controls.compose.button).on('click',function(){_.content(_.variable.module.link()+'/reply_mail.cgi?new=1&folder=0');});},submit=function submit(data,actions,messages){var refetch=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var reset=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var form=data.form_list,target=_.variable.module.link()+('/'+form.target+'?'),hidden=form.hidden,searched_index=data.searched_folder_index;hidden=_.plugin.json_to_query(hidden)+'&noredirect=1&';if(searched_index){hidden=hidden.replace(/folder=\d+/,'folder='+searched_index);}actions=_.plugin.json_to_query(actions);messages='&d='+messages.join('&d=');refetch&&(loader.start(),_.notification('hide-all'));$.post(target+hidden+actions+messages,function(){if(reset){storage.reset();}if(refetch){$.post(_.path.extensions+'/mail/messages.cgi?'+hidden+'show_body_len='+preview_length()+'',function(data){render(data);loader.end();});}});},render=function render(source){var container=$$.element('layout.container'),data=source[0],controls={select:data.form_list.buttons.select,submit:data.form_list.buttons.submit},pagination={link:data.pagination_arrow_last||data.pagination_arrow_first||String(),title:data.pagination_arrow_last?_.language('theme_xhred_mail_pagination_last'):data.pagination_arrow_first?_.language('theme_xhred_mail_pagination_first'):false},messages_list=data.list.messages?data.list.messages.replace(/�/g,''):String();if(data.error){var errors=data.error.error;for(var i=0;i<errors.length;i++){_.notification(['exclamation-circle',errors[i]],20,"error",i,1,['top','center']);}return;}var messages_list_available=messages_list.length>128?1:0;if(!messages_list_available&&data.searched){_.notification(['search',_.language('theme_xhred_mail_search_empty')],5,"info",0,0,['top','right']);return;}container.empty().append($$.create.$('layout.panel'));var panel=container.find($$.selector('layout.panel'));if(messages_list_available){var _$$$create$$,_$$$create$$2,_$$$create$$3,_$$$create$$4,_$$$create$$5,_$$$create$$6,_$$$create$$7,_$$$create$$8,_$$$create$$9,_$$$create$$10,_$$$create$$11;panel.append($$.create.$('layout.row.controls')).find($$.selector('layout.row.controls')).append($$.create.$('layout.column.6'),$$.create.$('layout.column.6')).find($$.selector('layout.column.6')).first().append($$.create.dropdown('controls.select.dropdown',[[controls.select.all,controls.select.none,controls.select.invert,controls.select.read,controls.select.unread,controls.select.special],3],$$.create.checkbox({select:1}),String(),_.language('theme_xhred_global_select')));var $form_controls=$($$.create.$('layout.controls',{'form-controls':1},'div'));Object.entries(controls.submit).map(function(_ref7){var _ref8=_slicedToArray(_ref7,2),type=_ref8[0],data=_ref8[1];var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=data.entries()[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _ref9=_step3.value;var _ref10=_slicedToArray(_ref9,2);var _i3=_ref10[0];var v=_ref10[1];if(type==='buttons'){$form_controls.append($$.create.$('controls.'+v[0],{'form-control':v[0]},'span',String(),_.language('theme_xhred_global_'+v[0]+'')));}else if(type==='dropdowns'){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=v.entries()[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var _ref11=_step4.value;var _ref12=_slicedToArray(_ref11,2);var di=_ref12[0];var dd=_ref12[1];var entries=[];var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=v[1].entries()[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _ref13=_step5.value;var _ref14=_slicedToArray(_ref13,2);var index=_ref14[0];var _data=_ref14[1];_data[0]&&entries.push($$.create.$(0,{'form-action':_data[0]},'span',_data[1]));}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}if(typeof dd==="string"){$form_controls.append($$.create.dropdown('controls.'+dd+'.dropdown',[entries,2],0,dd,_.language('theme_xhred_mail_'+dd+'')||_.language('theme_xhred_global_'+dd+'')));}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}});panel.find($$.selector('layout.column.6')).first().append($form_controls,$$.create.dropdown('controls.sort.dropdown',[[data.list.sort.date,data.list.sort.from,data.list.sort.size,data.list.sort.subject,data.list.sort.spam],5],data.list.sorted,'sort',_.language('theme_xhred_global_sort')),$$.create.dropdown('controls.search.dropdown',[[$$.create.$(0,(_$$$create$$={},_defineProperty(_$$$create$$,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$,$$.$.controls.search.data.form.type,'simple'),_$$$create$$),'span',$$.create.input('search',_.language('theme_xhred_mail_search_search_mail'),String(),'text',{'search-mail':1})+$$.create.button('layout.button.transparent',{'toggle-type':1},String(),'controls.search.caret.down')),$$.create.$(0,(_$$$create$$2={},_defineProperty(_$$$create$$2,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$2,$$.$.controls.search.data.form.advanced,1),_$$$create$$2),'span',$$.create.$('layout.column.3',{},'span',$$.create.label('search-from',_.language('theme_xhred_mail_search_from')))+$$.create.$('layout.column.9',{},'span',$$.create.input('search-from'))),$$.create.$(0,(_$$$create$$3={},_defineProperty(_$$$create$$3,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$3,$$.$.controls.search.data.form.advanced,1),_$$$create$$3),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-to',_.language('theme_xhred_mail_search_to')))+$$.create.$('layout.column.9',0,'span',$$.create.input('search-to'))),$$.create.$(0,(_$$$create$$4={},_defineProperty(_$$$create$$4,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$4,$$.$.controls.search.data.form.advanced,1),_$$$create$$4),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-subject',_.language('theme_xhred_mail_search_subject')))+$$.create.$('layout.column.9',0,'span',$$.create.input('search-subject'))),$$.create.$(0,(_$$$create$$5={},_defineProperty(_$$$create$$5,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$5,$$.$.controls.search.data.form.advanced,1),_$$$create$$5),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-wordsin',_.language('theme_xhred_mail_search_has_words')))+$$.create.$('layout.column.9',0,'span',$$.create.input('search-wordsin'))),$$.create.$(0,(_$$$create$$6={},_defineProperty(_$$$create$$6,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$6,$$.$.controls.search.data.form.advanced,1),_$$$create$$6),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-wordsout',_.language('theme_xhred_mail_search_doesnt_have_words')))+$$.create.$('layout.column.9',0,'span',$$.create.input('search-wordsout'))),$$.create.$(0,(_$$$create$$7={},_defineProperty(_$$$create$$7,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$7,$$.$.controls.search.data.form.advanced,1),_$$$create$$7),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-status',_.language('theme_xhred_mail_search_with_status')))+$$.create.$('layout.column.9',0,'span',$$.create.radio(0,'status',-1,_.language('theme_xhred_mail_search_with_status_any'),'status_def','checked')+$$.create.radio(0,'status',0,_.language('theme_xhred_mail_search_with_status_unread'),'status0')+$$.create.radio(0,'status',1,_.language('theme_xhred_mail_search_with_status_read'),'status1')+$$.create.radio(0,'status',2,_.language('theme_xhred_mail_search_with_status_special'),'status2'))),$$.create.$(0,(_$$$create$$8={},_defineProperty(_$$$create$$8,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$8,$$.$.controls.search.data.form.advanced,1),_defineProperty(_$$$create$$8,$$.$.controls.search.data.form.type,'search-in'),_$$$create$$8),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-folder',_.language('theme_xhred_mail_search_search_in')))+$$.create.$('layout.column.9',0,'span',data.form_list.buttons.submit.dropdowns[0][1][0][1])),$$.create.$(0,(_$$$create$$9={},_defineProperty(_$$$create$$9,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$9,$$.$.controls.search.data.form.advanced,1),_defineProperty(_$$$create$$9,$$.$.controls.search.data.form.type,'limit'),_$$$create$$9),'span',$$.create.$('layout.column.3',0,'span',$$.create.label('search-wordsout',_.language('theme_xhred_mail_search_limit_results')))+$$.create.$('layout.column.9',0,'span',$$.create.radio(0,'limit_def',1,_.language('theme_xhred_global_no'),'limit_def0','checked')+$$.create.radio(0,'limit_def',0,_.language('theme_xhred_mail_search_limit_results_yes')+' '+$$.create.input('limit','',20,'number',['step="20"','min="10"'])+' latest messages','limit_def1'))),$$.create.$(0,(_$$$create$$10={},_defineProperty(_$$$create$$10,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$10,$$.$.controls.search.data.form.advanced,1),_defineProperty(_$$$create$$10,$$.$.controls.search.data.form.type,'attach'),_$$$create$$10),'span',$$.create.checkbox(0,'attach',1,_.language('theme_xhred_mail_search_has_attach'),'attach')),$$.create.$(0,(_$$$create$$11={},_defineProperty(_$$$create$$11,$$.$.controls.search.data.form.action,'search'),_defineProperty(_$$$create$$11,$$.$.controls.search.data.form.advanced,1),_defineProperty(_$$$create$$11,$$.$.controls.search.data.form.type,'submit'),_$$$create$$11),'span',$$.create.button('layout.button.primary',false,_.language('theme_xhred_global_search'),'controls.search.icon'))],5],data.searched_message?$$.create.$('controls.search.clear.link',['href="index.cgi?folder='+data.searched_folder_index+'"'],'a',$$.create.icon('controls.search.clear.icon')+' '+data.searched_message.toLowerCase(),_.language('theme_xhred_mail_search_clear')):String(),'search',_.language('theme_xhred_global_search')),$$.create.$('controls.counter',0,'span')).end().last().append($$.create.$('controls.refresh.button',{'refresh':1},'span',String(),_.language('theme_xhred_global_refresh')),$$.create.$('controls.pagination',pagination.link?['href="'+pagination.link+'"','data-href="'+pagination.link+'"']:false,'a',data.pagination_message,pagination.title),data.pagination_arrow_left,data.pagination_arrow_right);panel.append($$.create.$('layout.row.messages')).find($$.selector('layout.row.messages')).append($$.create.$('layout.column.12')).find($$.selector('layout.column.12')).append(messages_list);if(data.quota){panel.append($$.create.$('layout.row.quota')).find($$.selector('layout.row.quota')).last().append($$.create.$('layout.column.12')).find($$.selector('layout.column.12')).append(data.quota);}_.plugin.timestamp();_.plugin.tooltip();_.plugin.offset_adjust(true);_.rows();folders.set(data.searched_folder_id||data.folder_id);events(data);messages.storage.restore();}else{panel.append('No Mail');}};return{get:get,storage:storage};}();var folders=function(){var data={file:{fancytree:'jquery.fancytree'},selector:{navigation:'aside .navigation'},options:{tree:{escapeTitles:false,autoActivate:false,autoScroll:true,keyboard:false,toggleEffect:false},scroll:{axis:'xy',theme:'minimal',keyboard:false,scrollInertia:300,scrollButtons:true,autoHideScrollbar:false}},plugin:{tree:function tree(source){source=source==='get'?'getTree':source==='node'?'getActiveNode':Object.assign(data.options.tree,{source:source,click:function click(e,d){if(d.targetType==='title'){setTimeout(function(){_tree.adjust();},1e2);_.content(data.url.link+encodeURIComponent(d.node.key));messages.storage.reset();_.navigation.reset();}}});if($(_tree.container).length){return $(_tree.container).fancytree(source);}}},url:{link:_.path.origin+_.path.prefix+'/mailbox/index.cgi?id='}};var _tree={fetched:0,container:'['+$$.$.tree.container+']',container_adjust:function container_adjust(){var container=$(this.container+' >:first'),content=$(this.container+' >>:first');if(container.height()>content.height()){container.css('height',content.height());}},init:function init(source){if(this.fetched===0){this.load();return;}if($(data.selector.navigation+' '+this.container).length===0){$(data.selector.navigation).prepend('<li><div '+$$.$.tree.container+'></div></li>');$(data.selector.navigation).prepend('<li>'+$$.create.$('layout.button.block',{'compose':1},'span',$$.create.icon('controls.compose.icon')+" "+_.language('theme_xhred_mail_new_message'))+'</li>');}else{return;}data.plugin.tree(source);_.plugin.scroll(this.container,data.options.scroll);this.container_adjust();},expand:function expand(node){var expanded=node.isExpanded();!expanded&&node.toggleExpanded();},load:function load(){this.fetched=1;_.load.bundle(_.path.js+'/'+data.file.fancytree,_.path.css+'/'+data.file.fancytree,_.variable.switch()?[get]:0,1);},reload:function reload(source){var _this2=this;var tree=data.plugin.tree('get');tree.$container.empty();tree.reload(source);setTimeout(function(){_this2.adjust();},1e2);},node:function node(){return data.plugin.tree('node');},adjust:function adjust(){var $_=this.node();if($_&&$_.li&&$($_.li).length){_.plugin.scroll([this.container,$($_.li)]);}this.container_adjust();}};var get=function get(key){key=key?'?key='+key.replace(/&/g,'%26'):String();$.post(_.path.extensions+'/mail/folders.cgi'+key+'',function(source){if(!!key){_tree.reload(source);}else{_tree.init(source);}});};var set=function set(key){var _this3=this;var tree=data.plugin.tree('get');if((typeof tree==='undefined'?'undefined':_typeof(tree))==='object'&&typeof tree.activateKey==='function'){tree.activateKey(key);}else{setTimeout(function(){_this3.set(key);},1e2);}};var adjust=function adjust(){_tree.adjust();};return{get:get,set:set,adjust:adjust};}();return{folders:{get:folders.get,set:folders.set,adjust:folders.adjust},messages:{get:messages.get,sort:messages.sort}};}();
